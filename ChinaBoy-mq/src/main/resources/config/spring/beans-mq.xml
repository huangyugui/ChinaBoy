<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:jms="http://www.springframework.org/schema/jms"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-4.2.xsd
           http://www.springframework.org/schema/jms
           http://www.springframework.org/schema/jms/spring-jms-4.2.xsd">
	
	<!-- 配置ActiveMQ连接 工厂-->
	<bean id="activemqConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
		<property name="brokerURL" value="${activemq.broker.url}" />
		<property name="userName" value="${activemq.username}" />
		<property name="password" value="${activemq.password}" />
	</bean>
	
	<!-- Spring Caching连接工厂 -->
 	<!-- Spring用于管理真正的ConnectionFactory的ConnectionFactory -->  
	<bean id="connectionFactory" class="org.springframework.jms.connection.CachingConnectionFactory">
		<!-- 目标ConnectionFactory对应真实的可以产生JMS Connection的ConnectionFactory -->  
  		<constructor-arg ref="activemqConnectionFactory" />
  		<!-- Session缓存数量 -->
		<property name="sessionCacheSize" value="${activemq.sessionCacheSize}" />
	</bean>
	
	<!-- Spring Queue JMS Template -->
	<bean id="queueJmsTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory" ref="activemqConnectionFactory"/>
		<!-- pub/sub模型(发布/订阅) -->
		<property name="pubSubNoLocal" value="false"/>
		<!-- 默认目的地 -->
		<property name="defaultDestination" ref="queueDestination"/>
		<!-- 默认失效时间为0,不失效-->
		<property name="timeToLive" value="3"/>
	</bean>
	
	<!-- Spring Topic JMS Template -->
	<bean id="topicJmsTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory" ref="activemqConnectionFactory"/>
		<!-- pub/sub模型(发布/订阅) -->
		<property name="pubSubNoLocal" value="true"/>
		<!-- 默认目的地 -->
		<property name="defaultDestination" ref="topicDestination"/>
		<!-- 默认失效时间为0,不失效-->
		<property name="timeToLive" value="3"/>
	</bean>
	
	<!-- 配置队列消息默认目的地 -->
	<bean id="queueDestination" class="org.apache.activemq.command.ActiveMQQueue">
	    <constructor-arg><value>${activemq.queue.name}</value></constructor-arg>
	</bean>
	
	<!-- 配置订阅发布消息默认目的地 -->
	<bean id="topicDestination" class="org.apache.activemq.command.ActiveMQTopic">
	    <constructor-arg><value>${activemq.topic.name}</value></constructor-arg>
	</bean>

	<!-- 消息消费者 start-->
	
	<!-- 定义Queue Master监听器 -->
	<jms:listener-container destination-type="queue" container-type="default" connection-factory="connectionFactory" acknowledge="auto">
		<jms:listener destination="${activemq.queue.name}" ref="queueListener"/>
	</jms:listener-container>
	
	<!-- 定义Topic Master监听器 -->
	<jms:listener-container destination-type="topic" container-type="default" connection-factory="connectionFactory" acknowledge="auto">
		<jms:listener destination="${activemq.topic.name}" ref="topicListenerMaster"/>
	</jms:listener-container>
	<!-- 定义Topic Slave监听器 -->
	<jms:listener-container destination-type="topic" container-type="default" connection-factory="connectionFactory" acknowledge="auto">
		<jms:listener destination="${activemq.topic.name}" ref="topicListenerSlave"/>
	</jms:listener-container>
	
	<!-- 消息消费者 end -->
	
</beans>